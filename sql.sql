/*
Необходимо выгрузить номера карт, которые заправлялись с 01.11-30.11 от 16 заправок и более
( главное условие чтобы минимум в 1 чеке было от 1500 рублей на топливо и хот дог).

Нужны только номера карт
*/

SELECT
  cards.uid,
  count(DISTINCT orders.id) AS orders_count
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN orders ON orders.card_id = cards.id
  INNER JOIN goods_incomes ON goods_incomes.order_id = orders.id
  INNER JOIN (
               SELECT orders.*
               FROM orders
               WHERE orders.client_id = 625
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                   INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-11-01'
                       AND orders.from <= '2020-11-30 23:59:59'
                       AND goods_incomes.goods_id IN (
                   1516847, 2305419, 3013460, 1516843, 1516845, 1516848, 2212948, 1516849, 1516851, 1518158, 2107476, 2528930
                 )
                       AND goods_incomes.goods_summary >= 1500
                 GROUP BY orders.id
               )
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                   INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                   INNER JOIN goods ON goods.id = goods_incomes.goods_id
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-11-01'
                       AND orders.from <= '2020-11-30 23:59:59'
                       AND goods.article IN (
                   '020816', '020822', '020821', '021451', '020812', '020819', '023933', '020818', '020813', '023934', '023979', '023889', '024524', '024531', '023892', '024533', '021648', '024535', '021630', '021626', '024537', '023888', '023893', '023891', '023894', '023895', '023607', '022951', '022952', '023890', '022954', '023109', '022417', '022416', '022785', '022786', '024689', '024523', '024526', '024527', '024528', '024529', '020740', '020741', '020596', '016517', '023606', '013474', '009909', '022782', '020902', '023085', '022781', '017274', '023088', '013479', '020808', '020810', '020674', '024138', '021454', '022789', '022791', '022788', '024534', '024532', '024530', '024536', '024690', '024525', '022790', '022792', '022441', '022787', '022440'
                 )
                 GROUP BY orders.id
               )
             ) AS custom_orders ON custom_orders.card_id = cards.id
WHERE cards.client_id = 625
      AND goods_incomes.goods_id IN (
  1516847, 2305419, 3013460, 1516843, 1516845, 1516848, 2212948, 1516849, 1516851, 1518158, 2107476, 2528930
)
      AND orders.from >= '2020-11-01'
      AND orders.from <= '2020-11-30 23:59:59'
GROUP BY cards.id
HAVING orders_count >= 16;


/*Необходимо выгрузить отчет данных по клиентам, которые последнюю покупку делали до 01.11.2020

1) Номер карты, ФИО, номер телефона, согласие на получение уведомлений ( да/нет), Дата последней покупи*/

SELECT
  cards.uid,
  profiles.name,
  profiles.phone,
  profiles.send_sms,
  orders.from
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN orders ON orders.card_id = cards.id
WHERE cards.client_id = 1008
      AND orders.from <= '2020-11-01 23:59:59'
GROUP BY cards.id
ORDER BY orders.from DESC;

/*
Необходимо выгрузить номера карт и дату последней покупки в таблицу Excel, условия следующие:

Клиенты, которые не пили кофе ( артикулы во вложении) с 1.01.20 по 24.11.20 включительно и имеют мобильное приложение.
*/

SELECT
  cards.uid,
  MAX(orders.from)
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN orders ON orders.card_id = cards.id
  INNER JOIN (SELECT profile_id
              FROM profiles_worksheets
              WHERE worksheet_id = 207 AND value = '1') AS pw ON pw.profile_id = profiles.id
WHERE cards.client_id = 625
      AND orders.from >= '2020-01-01'
      AND orders.from <= '2020-11-24 23:59:59'
      AND cards.id NOT IN (
  SELECT cards.id
  FROM cards
    INNER JOIN profiles ON profiles.id = cards.profile_id
    INNER JOIN orders ON orders.card_id = cards.id
    INNER JOIN goods_incomes ON goods_incomes.order_id = orders.id
  WHERE cards.client_id = 625
        AND orders.from >= '2020-01-01'
        AND orders.from <= '2020-11-24 23:59:59'
        AND goods_incomes.goods_id IN (
    1517225, 1518183, 1525781, 1516892, 1518896, 1519651, 1517452, 1517453, 1517991, 1517454, 1516863, 1516866, 1516865, 1516867, 1516868, 1516869, 1516871, 1516881, 1518888, 1519652, 1517450, 1517451, 1517456, 1516882, 1519344, 2441615, 1519361, 1519374, 1519432, 1519434, 1519433, 1519430, 1519431, 1519435, 1519439, 1519436, 1518895, 1519650, 1516890, 1516496, 1516498, 1516499, 1518893, 1516888, 1519364, 1518889, 1516884, 1518892, 1519649, 2193061, 1516886, 2201956, 1516885, 1516887, 1518891, 1518378, 1518894, 1516889, 1516883, 1522602, 1522603, 1522604, 1522599, 1522601, 1519354, 1519129, 1519128, 1517530, 1525200, 1516891, 1519376, 1519375, 1519352, 1519372, 1519351, 1519373, 1519378, 1519348, 1519377, 1519346, 1519349, 1519370, 1517238, 1517239, 1519103, 1519104, 1519347, 1519345, 1517241, 1517240, 1521330, 1521332, 1521331, 1524979, 1524980, 1519355, 1524887, 1524877, 1524880, 1524886, 1524878, 1524881, 1517975, 1517959, 1517964, 1517965, 1517960, 1517976, 1524896, 1524889, 1524892, 1517966, 1517957, 1517973, 1517974, 1517958, 1517967, 1524893, 1524895, 1524888, 1524883, 1524884, 1517970, 1517971, 1524869, 1524867, 1524865, 1524866, 1524872, 1524870, 1517955, 1517949, 1517944, 1517956, 1517950, 1517945, 1524868, 1524871, 1517952, 1517953, 1517984, 1517985, 1517983, 1517982, 2100032, 2102346, 2100526, 2029017, 2029019, 2029018, 2029014, 2029013, 2029015, 2029016, 2029024, 2029026, 2029021, 2029027, 2029022, 2099946, 2099659, 2099388, 2100565, 2100122, 2099736, 2003949, 2101292, 2022138, 2099384, 2010210, 2099739, 2076155, 2087466, 2021077, 2087689, 2086283, 2022647, 2099521, 2095765, 2095867, 2086495, 2102053, 2102402, 2029020, 2029023, 2029025, 2029008, 2029009, 2029010, 2029012, 1518890, 2003890, 2073701, 2000073, 2080983, 2077750, 2027909, 2101879, 2003958, 2003969, 2010584, 2072975, 2028372, 2073586, 1999525, 2030387, 2030939, 2003884, 2099808, 1998867, 2100751, 2088373, 2100714, 2101812, 2097224, 2096576, 2095702, 2088350, 2029035, 2029036, 2010211, 2029034, 2099753, 2029031, 2029028, 2029030, 2029029, 2086199, 2086206, 2086091, 2095699, 2101073, 2096199, 2099741)
  GROUP BY cards.id
)
GROUP BY cards.id;

/* Нужно выбрать карты Светофор ( эти карты начинаются с цифр 220950000....) и выгрузить их в таблицу Excel, со следующими данными:

1) Номер карты
2) Дата привязки профиля к карте
3) Кол-во чеков за весь период
4)Дата последнего чека
5)Номер телефона
6) Общая сумма начисленных бонусов за весь период
7) Общая сумма потраченных бонусов за весь период

SQL + скрипт
*/

SELECT
  cards.uid,
  hpc.created_at,
  count(DISTINCT orders.id),
  max(orders.from),
  profiles.phone,
  sum(goods_incomes.bonus_add),
  sum(goods_incomes.bonus_remove)
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  LEFT OUTER JOIN goods_incomes ON goods_incomes.order_id = orders.id
  LEFT OUTER JOIN (
                    SELECT *
                    FROM history_profiles_change
                    WHERE client_id = 625 AND is_creation = TRUE
                  ) AS hpc ON hpc.profile_id = profiles.id
WHERE cards.client_id = 625
      AND cards.uid LIKE '220950000%'
GROUP BY cards.id;


/*
1008
Необходимо выгрузить данные в 2 таблицы Excel:
Нужно выбрать 1000 клиентов сначала за октябрь ( период 01.10.20-31.10.20) ,
затем за ноябрь ( 01.11.20-30.11.20) .
Сформировать список клиентов у кого самая большая сумма покупок за эти периоды:

1) Номер карты
2) ФИО
3) Номер телефона
4) Общая  сумма продаж за заданные периоды.
выбрать 1000 клиентов у которых сумма наибольшая
*/

SELECT
  cards.uid,
  profiles.name,
  profiles.phone,
  SUM(orders.summary) AS sum_orders
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN orders ON orders.card_id = cards.id
WHERE cards.client_id = 1008
      AND orders.from >= '2020-11-01'
      AND orders.from <= '2020-11-30 23:59:59'
GROUP BY cards.id
ORDER BY sum_orders DESC
LIMIT 1000;


/*
Необходимо загрузить в "Списки клиентов" 2 группы карт.

1) Название списка "Не покупали 2 недели"
2) Название списка " Не покупали месяц"
*/

SELECT profiles.id
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
WHERE cards.client_id = 1008
      AND cards.uid IN (
  '79859944731', '79015019844', '79131456948', '79273250575', '79859659620', '79011885227', '79652469945')
GROUP BY cards.id;

SELECT *
FROM buyer_lists
WHERE client_id = 1008;


/*Клиент, просит дополнить таблицу во вложении:

Описание:


Запрос выборка карт с параметрами

заправка на азс № 9, 8, 7, 6, 5, 4, 3, 24, 23, 21, 20, 10, 19, 18, 17, 16, 15, 14, 13, 1
1 карта активная (3-5 заправок на станции за последний месяц 01.11 - 30.11)
1 карта не активная (после 01.11 отсутствовала совсем, но была заправка в период 01.10 по31.10)
по видам топлива АИ-92-К5, АИ-95-К5, АИ-95-К5 GT, ДТ-3-К5*/

SELECT
  cards.uid,
  count(DISTINCT orders.id) AS count_orders
FROM cards
  INNER JOIN orders ON orders.card_id = cards.id
  INNER JOIN (
               SELECT orders.*
               FROM orders
               WHERE orders.client_id = 625
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-11-01'
                       AND orders.from <= '2020-11-30 23:59:59'
                       AND orders.shop_id IN (
                   2291, 2297, 2311, 2312, 2304, 2303, 2287, 2286, 2300, 2301, 2302, 2481, 2479, 2315, 2316, 2317, 2318, 2289, 2319, 2320, 2254, 2292, 2277, 2278, 2279, 2280, 3309, 2288, 2290, 2255, 2256, 2283, 2284, 2285, 2564, 2253, 2299
                 )
                 GROUP BY orders.id
               )
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                   INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                   INNER JOIN goods ON goods.id = goods_incomes.goods_id
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-11-01'
                       AND orders.from <= '2020-11-30 23:59:59'
                       AND goods.article IN (
                   'ДТ-З-К5',
                   'АИ-95-К5',
                   'АИ-95-К5',
                   'АИ-95-К5 GT',
                   'АИ-95-К5 GT',
                   'АИ-92-К5',
                   'АИ-92-К5'
                 )
                 GROUP BY orders.id
               )
                     AND orders.from >= '2020-11-01'
                     AND orders.from <= '2020-11-30 23:59:59'
             ) AS custom_orders ON custom_orders.card_id = cards.id
WHERE cards.client_id = 625
      AND orders.shop_id IN (
  2291, 2297, 2311, 2312, 2304, 2303, 2287, 2286, 2300, 2301, 2302, 2481, 2479, 2315, 2316, 2317, 2318, 2289, 2319, 2320, 2254, 2292, 2277, 2278, 2279, 2280, 3309, 2288, 2290, 2255, 2256, 2283, 2284, 2285, 2564, 2253, 2299
)
      AND orders.from >= '2020-11-01'
      AND orders.from <= '2020-11-30 23:59:59'
GROUP BY cards.id
HAVING count_orders >= 3
       AND count_orders <= 5;

/*
9 - 2291
8 - 2297
7 - 2311, 2312
6 - 2304, 2303
5 - 2287, 2286
4 - 2300
3 - 2301, 2302
24 - 2481, 2479
23 - 2315, 2316, 2317, 2318
21 - 2289
20 - 2319, 2320
10 - 2254
19 - 2292
18 - 2277, 2278, 2279, 2280, 3309
17 - 2288
16 - 2290
15 - 2255, 2256
14 - 2283, 2284, 2285, 2564
13 - 2253
1 - 2299

*/

SELECT
  cards.uid,
  count(DISTINCT orders.id) AS count_orders,
  MAX(orders.`from`) AS max_date
FROM cards
  INNER JOIN orders ON orders.card_id = cards.id
  INNER JOIN (
               SELECT orders.*
               FROM orders
               WHERE orders.client_id = 625
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-10-01'
                       AND orders.from <= '2020-12-03 23:59:59'
                       AND orders.shop_id IN (
                   2291, 2297, 2311, 2312, 2304, 2303, 2287, 2286, 2300, 2301, 2302, 2481, 2479, 2315, 2316, 2317, 2318, 2289, 2319, 2320, 2254, 2292, 2277, 2278, 2279, 2280, 3309, 2288, 2290, 2255, 2256, 2283, 2284, 2285, 2564, 2253, 2299
                 )
                 GROUP BY orders.id
               )
                     AND orders.id IN (
                 SELECT orders.id
                 FROM orders
                   INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                   INNER JOIN goods ON goods.id = goods_incomes.goods_id
                 WHERE orders.client_id = 625
                       AND orders.from >= '2020-10-01'
                       AND orders.from <= '2020-12-03 23:59:59'
                       AND goods.article IN (
                   'ДТ-З-К5',
                   'АИ-95-К5',
                   'АИ-95-К5',
                   'АИ-95-К5 GT',
                   'АИ-95-К5 GT',
                   'АИ-92-К5',
                   'АИ-92-К5'
                 )
                 GROUP BY orders.id
               )
                     AND orders.from >= '2020-10-01'
                     AND orders.from <= '2020-12-03 23:59:59'
             ) AS custom_orders ON custom_orders.card_id = cards.id
WHERE cards.client_id = 625
      AND orders.shop_id IN (
  2291, 2297, 2311, 2312, 2304, 2303, 2287, 2286, 2300, 2301, 2302, 2481, 2479, 2315, 2316, 2317, 2318, 2289, 2319, 2320, 2254, 2292, 2277, 2278, 2279, 2280, 3309, 2288, 2290, 2255, 2256, 2283, 2284, 2285, 2564, 2253, 2299
)
      AND orders.from >= '2020-10-01'
      AND orders.from <= '2020-12-03 23:59:59'
GROUP BY cards.id
HAVING max_date <= '2020-10-31 23:59:59'



/*
По приведенным ниже артикулам, необходимо выгрузить кол-во купленных чашек всего за период с 14.12-20.12

017811
017812
017813
017814
015912
016163
016172
016074
021662


Саша, по этим данным нужно выгрузить 51 неделю в понедельник.
*/


SELECT
  cup.article,
  count(cup.id)
FROM cards
  INNER JOIN (
               SELECT
                 orders.*,
                 goods.article
               FROM orders
                 INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 INNER JOIN goods ON goods.id = goods_incomes.goods_id
               WHERE orders.client_id = 625
                     AND orders.from >= '2020-12-21'
                     AND orders.from <= '2020-12-27 23:59:59'
                     AND goods.article IN (
                 '017811',
                 '017812',
                 '017813',
                 '017814',
                 '015912',
                 '016163',
                 '016172',
                 '016074',
                 '021662'
               )
             ) AS cup ON cup.card_id = cards.id
WHERE cards.client_id = 625
GROUP BY cup.article;


SELECT *
FROM cards
WHERE cards.client_id = 888
      AND cards.uid = '79171332415';

/*
Привязкать телефон к личному кабинету
*

select * from goods
where goods.client_id = 1004;

*/

/*
Декорадо 780
 */

SELECT *
FROM goods
WHERE goods.client_id = 780;

SELECT *
FROM goods_categories
WHERE client_id = 780;

/*3735*/

SELECT *
FROM bills
WHERE id = 3735;

UPDATE bills
SET bills.exported = 1
WHERE bills.id = 3735;


/*
У АЗС есть списки клиентов "Monopoly", "Monopoly2", 1ДТ_РОЗНИЦА".

С 26.11 у данных клиентов наложились программы лояльности ( действовала и скидочная и бонусная система" .

Вопрос: Можно у этих  клиентов с 26.11-25.12 списать все начисленные бонусы за этот период?
*/

/*
1616
1669
1661
*/

SELECT *
FROM buyer_lists
WHERE client_id = 625
      AND name = '1ДТ_РОЗНИЦА';

SELECT buyers_list.buyers
FROM buyers_list
WHERE buyer_list_id = 1661;

SELECT cards.id
FROM cards
  INNER JOIN profiles ON cards.id = profiles.card_id
WHERE cards.client_id = 625
      AND profile_id IN (123);


UPDATE balance_movements
SET balance_movements.end_date = NOW()
where balance_movements.card_id in ('1331702','1331811','1335207','1335564','1335668','1340440','1341623','1347628','1348794','1349569','1351839','1352340','1353943','1354155','1354533','1354637','1354778','1354797','1354801','1354821','1354855','1354882','1356797','1356809','1357028','1357057','1361978','1367523','1367614','1368365','1368472','1369752','1369971','1374855','1376936','1377632','1378731','1381074','1381108','1381111','1384072','1386172','1386294','1386369','1386408','1388300','1388775','1389569','1389577','1389585','1389591','1389597','1389598','1389617','1390583','1390589','1390599','1390606','1390608','1390617','1390619','1390655','1390659','1392389','1392786','1394038','1394377','1394488','1395378','1399152','1399173','1399597','1404109','1404801','1404875','1408729','1408888','1408891','1408905','1408918','1408968','1409979','1411862','1412430','1417737','1420786','1420959','1422794','1424277','1426968','1427123','1429503','1429854','1430452','1430869','1432391','1434188','1434396','1434488','1436873','1437020','1444494','1800130','1467765','1464251','1462402','1462840','1462829','1462873','1462869','1462868','1462856','1854916','1462859','1855827','1855985','1462866','1462894','1858158','1462886','1462883','1462876','1462930','1462918','1462948','1462947','1852683','1462973','1462955','1463025','1463030','1463033','1463068','1463072','1463093','1463085','1463099','1463173','1463166','1463218','1463239','2984194','1463209','2998249','3000258','3001758','1461153','1480928','3048704','3057945','1478365','3060302','1480094','3061865','3072105','3752854','1481156','3760183','3762336','1482371','3769265','1478921','3784971','3775422','3773301','3775326','3779125','3775416','3773679','3787537','3783439','3775562','1481421','3783629','3789302','1474072','3783759','1463224','1463225','3776947','3775498','3789612','1482995','3791237','3775407','1463226','1463227','1463249','1463289','1463290','1463291','1463292','1463293','1463294','1463295','1463296','1463297','1463298','1463250','1463251','1463252','1463253','1463254','1463255','1463256','1463319','1463320','1482219','1479566','1462794','1462795','1462796','1462797','1462798','1463300','1463301','1463302','1463303','1463304','1463305','1463306','1463307','1463308','1463309','1463310','1463262','1463263','1463264','1463265','1463266','1463267','1463268','1463269','1463270','1463271','1463272','1843833','1843834','1843836','1843837','1843838','1843839','1843840','1843841','1843842','1843843','1843844','1843845','1843846','1843847','1843848','1843849','1843850','1843851','3783663','1843765','1843878','1843835','1854279','1854280','1854281','1854276','1854277','1854278','1854272','1854273','1854274','1854275','1462758','3781153','1482688','1462754','1462755','1462756','1462757','1462749','1462750','1462751','1462752','1462753','1843876','1843875','1843874','1843873','1843872','1843871','1843870','1843869','1843868','1843867','1843866','1475343','1481411','3773465','1462450','1482693','1462748','1843853','1843760','1843782','1843772','1843771','1843770','1843769','1843768','1843742','1843741','1843740','1843736','1843735','1843734','1843733','1843743','1843744','1843738','1843764','1843737','1843739','1843758','1843750','1843749','1843755','1843754','3783269','1854357','1854358','1854359','1854360','1854361','1854362','1854363','1854364','1854365','1854366','1462745','1462721','1462547','1462722','1462723','1462724','1462725','1462727','1462729','1462728','1462726','1462768','1481627','1843757','1843756','1843753','1843751','1843752','1843781','1843746','1843767','1843745','1843778','1843759','1843779','1843766','1843762','1843763','1843761','1843776','1843775','1843774','1843773','1843777','1843747','1843748','1843780','1462760','1474172','3780201','1472198','1472199','1472200','1472201','1472202','1472203','1472112','1472113','1472114','1472115','1472116','1472117','1472118','1472119','1472120','1472121','1472122','1472123','1472124','1472125','1472126','1472127','1472128','1472129','1472130','1472131','1472132','1472133','1472134','1472135','1472136','1472137','1472138','1472139','1472140','1472141','1472142','1472143','1472144','1472145','1472146','1472147','1472148','1472149','1472150','1472151','1472152','1472153','1472154','1472155','1472156','1472157','1472158','1472159','1472160','1472161','1472162','1472163','1472164','1472165','1472166','1472167','1472168','1472169','1472170','1472171','1472172','1472173','1472174','1472175','1472176','1472177','1472178','1472179','1472180','1472181','1472182','1472183','1472184','1472185','1472186','1472187','1472188','1472189','1472190','1472191','1472192','1472193','1472194','1472195','1472196','1472197','1472204','1472205','1472206','1472207','1472208','1472209','1472210','1472211','1472212','1472248','1472249','1472250','1472251','1472252','1472253','1472254','1472255','1472256','1472257','1472258','1472259','1472260','1472261','1472262','1472263','1472264','1472265','1472266','1472267','1472268','1472269','1472270','1472271','1472298','1472299','1472300','1472301','1472302','1472303','1472304','1472305','1472306','1472307','1472308','1472309','1472310','1472311','1472312','1472313','1472314','1472315','1472316','1472317','1472318','1472319','1472320','1472321','1472322','1841102','1841103','1841104','1841105','1841106','1841107','1841108','1841109','1841110','1841111','1841112','1841113','1841114','1841115','1841116','1841117','1841118','1841119','1841120','1841121','1841122','1841123','1841124','1841125','1841126','1841127','1841128','1841129','1841130','1841131','1841132','1841133','1841134','1841135','1841136','1841137','1841138','1841139','1841140','1841141','1841142','1841143','1841144','1841145','1841146','1841147','1841148','1841149','1841150','1841151','1841865','1841866','1841867','1841868','1841869','1841870','1841871','1841872','1841873','1841874','1841875','1841876','1841877','1841878','1841879','1841880','1841881','1841882','1841883','1841884','1841885','1841886','1841887','1841888','1841889','1841890','1841891','1841892','1841893','1841894','1841895','1841896','1841897','1841898','1841899','1841900','1841901','1841902','1841903','1841904','1841905','1841906','1841907','1841908','1841909','1841910','1841911','1841912','1841913','1841914','1846910','1846911','1846912','1846913','1846914','1846915','1846916','1846917','1846918','1846919','1846920','1846921','1846922','1846923','1846924','1846925','1846926','1846927','1846928','1846929','1846930','1846931','1846932','1846933','1846934','1846935','1846936','1846937','1846938','1846939','1846940','1846941','1846942','1846943','1846944','1846945','1846952','1846953','1846954','1846955','1846956','1846957','1846958','1846959','1846960','1846961','1846962','1846963','1847022','1847094','1849481','1849482','1849483','1849484','1849485','1849486','1849487','1849488','1849489','1849490','1849491','1849492','1849493','1849494','1849495','1849496','1849497','1849498','1849499','1849500','1849501','1849502','1849503','1849504','1849505','1849506','1849507','1849508','1849509','1849510','1849511','1849512','1849513','1849514','1849515','1849516','1849517','1849518','1849519','1849520','1849521','1849522','1849523','1849524','1849577','1849578','1849579','1849580','1849581','1849741','1849826','1849827','1849828','1849875','1849876','1849879','1849880','1849881','1849882','1849883','1849885','1849886','1849887','1849888','1849889','1849890','1849891','1849894','1849900','1849901','1849903','1849904','1849905','1849907','1849908','1849909','1849910','1849911','1849912','1849913','1849914','1849915','1849916','1849917','1849918','1849919','1849920','1849921','1849922','1849923','1849924','1849925','1849926','1849927','1849928','1849929','1849930','1849931','1849938','1853882','1853883','1853884','1853885','1853886','1853887','1853888','1853889','1853890','1853891','1853892','1853893','1853894','1853895','1853896','1853897','1853898','1853899','1853900','1853901','1853902','1853903','1853904','1853905','1853906','1853907','1853908','1853909','1853910','1853911','1853912','1853913','1853914','1853915','1853916','1853917','1853918','1853919','1853920','1853921','1853922','1853923','1853924','1853925','1853926','1853927','1853928','1853929','1853930','1853931','1853932','1853933','1853934','1853935','1853936','1853937','1853938','1853939','1853940','1853941','1853942','1853943','1853944','1853945','1853946','1853947','1853948','1853949','1853950','1853951','1853952','1853953','1853954','1853955','1853956','1853957','1853958','1853959','1853960','1853961','1853962','1853963','1853964','1853965','1853966','1853967','1853968','1853969','1853970','1853971','1853972','1853973','1853974','1853975','1853976','1853977','1853978','1853979','1853980','1853981','3779976','3786747','1476634','1462762','1843932','1843933','1843934','1843935','1843936','1843937','1843938','1843939','1843940','1843941','1843942','1843943','1843944','1843945','1843946','1843981','1843862','1843947','1843948','1843949','1843950','1843951','1843952','1843953','1843954','1843955','1843956','1843957','1843958','1843959','1843960','1843961','1843962','1843963','1843964','1843965','1843966','1843967','1843968','1843969','1843970','1843971','1843972','1843973','1843974','1843975','1843976','1843977','1843978','1843979','1843980','1462763','1462734','1462733','1462732','1462731','1462730','1462739','1462738','1462737','1462736','1462331','1462524','1462525','1462526','1462527','1462528','1462529','1462530','1462531','1462532','1462533','1462534','1462535','1462536','1462537','1462538','1462539','1462540','1462541','1462542','1462543','1462544','1462545','1462546','1462549','1462550','1462551','1462552','1462553','1462554','1462555','1462556','1462557','1462558','1462559','1462620','1462621','1462622','1462623','1462624','1462625','1462626','1462627','1462628','1462629','1462630','1462631','1462632','1462633','1462634','1462635','1462636','1462637','1462638','1462639','1462640','1462641','1462642','1462643','1462644','1462670','1462671','1462672','1462673','1462674','1462675','1462676','1462677','1462678','1462679','1462680','1462681','1462682','1462683','1462684','1462685','1462686','1462687','1462688','1462689','1462690','1462691','1462692','1462693','1462694','1462695','1462696','1462697','1462698','1462699','1462700','1462701','1462702','1462703','1462704','1462705','1462706','1462707','1462708','1462709','1462710','1462711','1462712','1462713','1462714','1462715','1462716','1462717','1462718','1462769','1462770','1462771','1462772','1462773','1462774','1462775','1462776','1462777','1462778','1462779','1462780','1462781','1462782','1462783','1462784','1462785','1462786','1462787','1462788','1462789','1462790','1462791','1462792','1462793','1462819','1462820','1462821','1462822','1462823','1472448','1472449','1472450','1472451','1472452','1472453','1472454','1472455','1472456','1472457','1472458','1472459','1472460','1472461','1472462','1472463','1472464','1472465','1472466','1472467','1472468','1472469','1472470','1472471','1472472','1472498','1472499','1472500','1472501','1472502','1472503','1472504','1472505','1472506','1472507','1472508','1472509','1472510','1472511','1472512','1472513','1472514','1472515','1472516','1472517','1472518','1472519','1472520','1472521','1843582','1843783','1843784','1843785','1843786','1843787','1843788','1843789','1843790','1843791','1843792','1843793','1843794','1843795','1843796','1843797','1843798','1843799','1843800','1843801','1843802','1843803','1843804','1843805','1843806','1843807','1843808','1843809','1843810','1843811','1843812','1843813','1843814','1843815','1843816','1843817','1843818','1843819','1843820','1843821','1843822','1843823','1843824','1843825','1843826','1843827','1843828','1843829','1843830','1843831','1849232','1849233','1849234','1849235','1849236','1849237','1849238','1849239','1849240','1849241','1849242','1849243','1849244','1849245','1849246','1849247','1849249','1849250','1849251','1849252','1849253','1849254','1849255','1849256','1849257','1849258','1849259','1849260','1849261','1849262','1849263','1849264','1849265','1849266','1849267','1849268','1849269','1849270','1849271','1849272','1849273','1849274','1849275','1849276','1849277','1849278','1849279','1849280','1849281','1853282','1853283','1853284','1853285','1853286','1853287','1853288','1853289','1853290','1853291','1853292','1853293','1853294','1853295','1853296','1853297','1853298','1853299','1853300','1853301','1853302','1853303','1853304','1853305','1853306','1853332','1853333','1853334','1853335','1853336','1853337','1853338','1853339','1853340','1853341','1853342','1853343','1853344','1853345','1853346','1853347','1853348','1853349','1853350','1853351','1853352','1853353','1853354','1853355','1853356','3792998','1476861','1481262','1854208','1854209','1854210','1854211','1854212','1854213','1854214','1854216','3783713','1854215','1462766','1854183','1854184','1854185','1854186','1854217','1854218','1854219','1854220','1854221','1854222','1854224','1854225','1854226','1854227','1854228','1854229','1854230','1854231','1854223','1462817','1481849','3789214','3785213','1462799','1462800','3779454','4308263','1843854','1843856','1462814','1462813','1843706','1843707','1843708','1843709','1843710','1843711','1843712','1843713','1843714','1843732','1843715','1843716','1843717','1843718','1843719','1843720','1843721','1843722','1843723','1843724','1843725','1843726','1843727','1843728','1462812','1843729','1843730','1843731','1843882','1843883','1843884','1843885','1843886','1843887','1843888','1843889','1843890','1843891','1843892','1843893','1843894','1843895','1843896','1843897','1843898','1843899','1843900','1843901','1843902','1843903','1843904','1843905','1843906','1843907','1843908','1843909','1843910','1843911','1843912','1843913','1843914','1843915','1843916','1843917','1843918','1843919','1843920','1843921','1843922','1843923','1843924','1843925','1843926','1843927','1843928','1843929','1843930','1843931','1462811','1462801','3776547','1462802','1462803','1462809','1462804','1462805','1475091','1462808','1462498','1462497','1462807','1462594','3792968','1854072','1854073','1854074','1854075','1854076','1854081','1854077','1854078','1854079','1854080','1854380','1843648','1462589','1462587','3790575','1854373','1462571','1462586','1477506','1843585','1462496','1483496','1483281','1843587','1843588','1843589','1843590','1843591','1843592','1843593','1843594','1843595','1843596','1843597','1843598','1843599','1843600','1843601','1843602','1843603','1843604','1843605','1843606','1843607','1843608','1843609','1476941','1854122','1854123','1854124','1854125','1854126','1854117','1854118','1854119','1854120','1854121','1854111','1854110','1854109','1854108','1854107','1854116','1854115','1854114','1854113','1854112','1462573','1462583','1462584','3776307','1843610','1843611','1843612','1843613','1843614','1843615','1843616','1843617','1843618','1843619','1843620','1843621','1843622','1843623','1843624','1843625','1843626','1843627','1843628','1843629','1843630','1843631','1843702','1843696','1843701','1843704','1843703','1843697','1843683','1843698','1843699','1462493','1462491','1843643','1462490','1843644','1843661','1845931','1845930','1845929','1845928','1845927','1845926','1845925','1845924','1845923','1845922','1845921','1845920','1845919','1845918','1845917','1845916','1845915','1845914','1845913','1845912','1845911','1845910','1845909','1845908','1845907','1845906','1845905','1845904','1845903','1845902','1845901','1843666','1845900','1845899','1845898','1845897','1845896','1845895','1845894','1845893','1845892','1845891','1845890','1845889','1845888','1845887','1845886','1845885','1845884','1845883','1845882','1845981','1845980','1845979','1845978','1845977','1845976','1845975','1845974','1845973','1845972','1845971','1845970','1845969','1845968','1845967','1845966','1845965','1845964','1845963','1845962','1845961','1845960','1845959','1845958','1845957','1845956','1845955','1845954','1845953','1845952','1845951','1845950','1845949','1845948','1845947','1845946','1845945','1845944','1845943','1845942','1845941','1845940','1845939','1845938','1845937','1845936','1845935','1845934','1845933','1845932','1462486','1476389','1462741','1482132','1845799','1845800','1845801','1845802','1845803','1845804','1845805','1845806','1845807','1845808','1845761','1845762','1845763','1845764','1845765','1845766','1845767','1845768','1845769','1845770','1845771','1845772','1845773','1845774','1845775','1845776','1845777','1845778','1845779','1845780','1845781','1845782','1845783','1845784','1845785','1845786','1845787','1845788','1845789','1845790','1845791','1845792','1845793','1845794','1845795','1845796','1845797','1845798','1845809','1845810','1845811','1845812','1845813','1845814','1845815','1845816','1845817','1845818','1845819','1845820','1845821','1845822','1845823','1845824','1845826','1845827','1845828','1845830','1845831','1845832','1845833','1845834','1845835','1845836','1845837','1845838','1845839','1845841','1845842','1845843','1845844','1845846','1845847','1845848','1845849','1845850','1845851','1845852','1845853','1845854','1845855','1845866','1845872','1845873','1845874','1845875','1845876','1845877','1845878','1845879','1845880','1462487','1462592','2933844','2933887','2933888','2933889','2933890','2933862','2933863','2933864','2933865','2933867','2933868','2933869','2933870','2933871','2933872','2933873','2933874','2933875','2933876','2933877','2933878','2933879','2933880','2933881','2933882','2933883','2933884','2933885','2933886')
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1;

UPDATE cards
SET cards.next_recalc = NOW()
where cards.id in ('1331702','1331811','1335207','1335564','1335668','1340440','1341623','1347628','1348794','1349569','1351839','1352340','1353943','1354155','1354533','1354637','1354778','1354797','1354801','1354821','1354855','1354882','1356797','1356809','1357028','1357057','1361978','1367523','1367614','1368365','1368472','1369752','1369971','1374855','1376936','1377632','1378731','1381074','1381108','1381111','1384072','1386172','1386294','1386369','1386408','1388300','1388775','1389569','1389577','1389585','1389591','1389597','1389598','1389617','1390583','1390589','1390599','1390606','1390608','1390617','1390619','1390655','1390659','1392389','1392786','1394038','1394377','1394488','1395378','1399152','1399173','1399597','1404109','1404801','1404875','1408729','1408888','1408891','1408905','1408918','1408968','1409979','1411862','1412430','1417737','1420786','1420959','1422794','1424277','1426968','1427123','1429503','1429854','1430452','1430869','1432391','1434188','1434396','1434488','1436873','1437020','1444494','1800130','1467765','1464251','1462402','1462840','1462829','1462873','1462869','1462868','1462856','1854916','1462859','1855827','1855985','1462866','1462894','1858158','1462886','1462883','1462876','1462930','1462918','1462948','1462947','1852683','1462973','1462955','1463025','1463030','1463033','1463068','1463072','1463093','1463085','1463099','1463173','1463166','1463218','1463239','2984194','1463209','2998249','3000258','3001758','1461153','1480928','3048704','3057945','1478365','3060302','1480094','3061865','3072105','3752854','1481156','3760183','3762336','1482371','3769265','1478921','3784971','3775422','3773301','3775326','3779125','3775416','3773679','3787537','3783439','3775562','1481421','3783629','3789302','1474072','3783759','1463224','1463225','3776947','3775498','3789612','1482995','3791237','3775407','1463226','1463227','1463249','1463289','1463290','1463291','1463292','1463293','1463294','1463295','1463296','1463297','1463298','1463250','1463251','1463252','1463253','1463254','1463255','1463256','1463319','1463320','1482219','1479566','1462794','1462795','1462796','1462797','1462798','1463300','1463301','1463302','1463303','1463304','1463305','1463306','1463307','1463308','1463309','1463310','1463262','1463263','1463264','1463265','1463266','1463267','1463268','1463269','1463270','1463271','1463272','1843833','1843834','1843836','1843837','1843838','1843839','1843840','1843841','1843842','1843843','1843844','1843845','1843846','1843847','1843848','1843849','1843850','1843851','3783663','1843765','1843878','1843835','1854279','1854280','1854281','1854276','1854277','1854278','1854272','1854273','1854274','1854275','1462758','3781153','1482688','1462754','1462755','1462756','1462757','1462749','1462750','1462751','1462752','1462753','1843876','1843875','1843874','1843873','1843872','1843871','1843870','1843869','1843868','1843867','1843866','1475343','1481411','3773465','1462450','1482693','1462748','1843853','1843760','1843782','1843772','1843771','1843770','1843769','1843768','1843742','1843741','1843740','1843736','1843735','1843734','1843733','1843743','1843744','1843738','1843764','1843737','1843739','1843758','1843750','1843749','1843755','1843754','3783269','1854357','1854358','1854359','1854360','1854361','1854362','1854363','1854364','1854365','1854366','1462745','1462721','1462547','1462722','1462723','1462724','1462725','1462727','1462729','1462728','1462726','1462768','1481627','1843757','1843756','1843753','1843751','1843752','1843781','1843746','1843767','1843745','1843778','1843759','1843779','1843766','1843762','1843763','1843761','1843776','1843775','1843774','1843773','1843777','1843747','1843748','1843780','1462760','1474172','3780201','1472198','1472199','1472200','1472201','1472202','1472203','1472112','1472113','1472114','1472115','1472116','1472117','1472118','1472119','1472120','1472121','1472122','1472123','1472124','1472125','1472126','1472127','1472128','1472129','1472130','1472131','1472132','1472133','1472134','1472135','1472136','1472137','1472138','1472139','1472140','1472141','1472142','1472143','1472144','1472145','1472146','1472147','1472148','1472149','1472150','1472151','1472152','1472153','1472154','1472155','1472156','1472157','1472158','1472159','1472160','1472161','1472162','1472163','1472164','1472165','1472166','1472167','1472168','1472169','1472170','1472171','1472172','1472173','1472174','1472175','1472176','1472177','1472178','1472179','1472180','1472181','1472182','1472183','1472184','1472185','1472186','1472187','1472188','1472189','1472190','1472191','1472192','1472193','1472194','1472195','1472196','1472197','1472204','1472205','1472206','1472207','1472208','1472209','1472210','1472211','1472212','1472248','1472249','1472250','1472251','1472252','1472253','1472254','1472255','1472256','1472257','1472258','1472259','1472260','1472261','1472262','1472263','1472264','1472265','1472266','1472267','1472268','1472269','1472270','1472271','1472298','1472299','1472300','1472301','1472302','1472303','1472304','1472305','1472306','1472307','1472308','1472309','1472310','1472311','1472312','1472313','1472314','1472315','1472316','1472317','1472318','1472319','1472320','1472321','1472322','1841102','1841103','1841104','1841105','1841106','1841107','1841108','1841109','1841110','1841111','1841112','1841113','1841114','1841115','1841116','1841117','1841118','1841119','1841120','1841121','1841122','1841123','1841124','1841125','1841126','1841127','1841128','1841129','1841130','1841131','1841132','1841133','1841134','1841135','1841136','1841137','1841138','1841139','1841140','1841141','1841142','1841143','1841144','1841145','1841146','1841147','1841148','1841149','1841150','1841151','1841865','1841866','1841867','1841868','1841869','1841870','1841871','1841872','1841873','1841874','1841875','1841876','1841877','1841878','1841879','1841880','1841881','1841882','1841883','1841884','1841885','1841886','1841887','1841888','1841889','1841890','1841891','1841892','1841893','1841894','1841895','1841896','1841897','1841898','1841899','1841900','1841901','1841902','1841903','1841904','1841905','1841906','1841907','1841908','1841909','1841910','1841911','1841912','1841913','1841914','1846910','1846911','1846912','1846913','1846914','1846915','1846916','1846917','1846918','1846919','1846920','1846921','1846922','1846923','1846924','1846925','1846926','1846927','1846928','1846929','1846930','1846931','1846932','1846933','1846934','1846935','1846936','1846937','1846938','1846939','1846940','1846941','1846942','1846943','1846944','1846945','1846952','1846953','1846954','1846955','1846956','1846957','1846958','1846959','1846960','1846961','1846962','1846963','1847022','1847094','1849481','1849482','1849483','1849484','1849485','1849486','1849487','1849488','1849489','1849490','1849491','1849492','1849493','1849494','1849495','1849496','1849497','1849498','1849499','1849500','1849501','1849502','1849503','1849504','1849505','1849506','1849507','1849508','1849509','1849510','1849511','1849512','1849513','1849514','1849515','1849516','1849517','1849518','1849519','1849520','1849521','1849522','1849523','1849524','1849577','1849578','1849579','1849580','1849581','1849741','1849826','1849827','1849828','1849875','1849876','1849879','1849880','1849881','1849882','1849883','1849885','1849886','1849887','1849888','1849889','1849890','1849891','1849894','1849900','1849901','1849903','1849904','1849905','1849907','1849908','1849909','1849910','1849911','1849912','1849913','1849914','1849915','1849916','1849917','1849918','1849919','1849920','1849921','1849922','1849923','1849924','1849925','1849926','1849927','1849928','1849929','1849930','1849931','1849938','1853882','1853883','1853884','1853885','1853886','1853887','1853888','1853889','1853890','1853891','1853892','1853893','1853894','1853895','1853896','1853897','1853898','1853899','1853900','1853901','1853902','1853903','1853904','1853905','1853906','1853907','1853908','1853909','1853910','1853911','1853912','1853913','1853914','1853915','1853916','1853917','1853918','1853919','1853920','1853921','1853922','1853923','1853924','1853925','1853926','1853927','1853928','1853929','1853930','1853931','1853932','1853933','1853934','1853935','1853936','1853937','1853938','1853939','1853940','1853941','1853942','1853943','1853944','1853945','1853946','1853947','1853948','1853949','1853950','1853951','1853952','1853953','1853954','1853955','1853956','1853957','1853958','1853959','1853960','1853961','1853962','1853963','1853964','1853965','1853966','1853967','1853968','1853969','1853970','1853971','1853972','1853973','1853974','1853975','1853976','1853977','1853978','1853979','1853980','1853981','3779976','3786747','1476634','1462762','1843932','1843933','1843934','1843935','1843936','1843937','1843938','1843939','1843940','1843941','1843942','1843943','1843944','1843945','1843946','1843981','1843862','1843947','1843948','1843949','1843950','1843951','1843952','1843953','1843954','1843955','1843956','1843957','1843958','1843959','1843960','1843961','1843962','1843963','1843964','1843965','1843966','1843967','1843968','1843969','1843970','1843971','1843972','1843973','1843974','1843975','1843976','1843977','1843978','1843979','1843980','1462763','1462734','1462733','1462732','1462731','1462730','1462739','1462738','1462737','1462736','1462331','1462524','1462525','1462526','1462527','1462528','1462529','1462530','1462531','1462532','1462533','1462534','1462535','1462536','1462537','1462538','1462539','1462540','1462541','1462542','1462543','1462544','1462545','1462546','1462549','1462550','1462551','1462552','1462553','1462554','1462555','1462556','1462557','1462558','1462559','1462620','1462621','1462622','1462623','1462624','1462625','1462626','1462627','1462628','1462629','1462630','1462631','1462632','1462633','1462634','1462635','1462636','1462637','1462638','1462639','1462640','1462641','1462642','1462643','1462644','1462670','1462671','1462672','1462673','1462674','1462675','1462676','1462677','1462678','1462679','1462680','1462681','1462682','1462683','1462684','1462685','1462686','1462687','1462688','1462689','1462690','1462691','1462692','1462693','1462694','1462695','1462696','1462697','1462698','1462699','1462700','1462701','1462702','1462703','1462704','1462705','1462706','1462707','1462708','1462709','1462710','1462711','1462712','1462713','1462714','1462715','1462716','1462717','1462718','1462769','1462770','1462771','1462772','1462773','1462774','1462775','1462776','1462777','1462778','1462779','1462780','1462781','1462782','1462783','1462784','1462785','1462786','1462787','1462788','1462789','1462790','1462791','1462792','1462793','1462819','1462820','1462821','1462822','1462823','1472448','1472449','1472450','1472451','1472452','1472453','1472454','1472455','1472456','1472457','1472458','1472459','1472460','1472461','1472462','1472463','1472464','1472465','1472466','1472467','1472468','1472469','1472470','1472471','1472472','1472498','1472499','1472500','1472501','1472502','1472503','1472504','1472505','1472506','1472507','1472508','1472509','1472510','1472511','1472512','1472513','1472514','1472515','1472516','1472517','1472518','1472519','1472520','1472521','1843582','1843783','1843784','1843785','1843786','1843787','1843788','1843789','1843790','1843791','1843792','1843793','1843794','1843795','1843796','1843797','1843798','1843799','1843800','1843801','1843802','1843803','1843804','1843805','1843806','1843807','1843808','1843809','1843810','1843811','1843812','1843813','1843814','1843815','1843816','1843817','1843818','1843819','1843820','1843821','1843822','1843823','1843824','1843825','1843826','1843827','1843828','1843829','1843830','1843831','1849232','1849233','1849234','1849235','1849236','1849237','1849238','1849239','1849240','1849241','1849242','1849243','1849244','1849245','1849246','1849247','1849249','1849250','1849251','1849252','1849253','1849254','1849255','1849256','1849257','1849258','1849259','1849260','1849261','1849262','1849263','1849264','1849265','1849266','1849267','1849268','1849269','1849270','1849271','1849272','1849273','1849274','1849275','1849276','1849277','1849278','1849279','1849280','1849281','1853282','1853283','1853284','1853285','1853286','1853287','1853288','1853289','1853290','1853291','1853292','1853293','1853294','1853295','1853296','1853297','1853298','1853299','1853300','1853301','1853302','1853303','1853304','1853305','1853306','1853332','1853333','1853334','1853335','1853336','1853337','1853338','1853339','1853340','1853341','1853342','1853343','1853344','1853345','1853346','1853347','1853348','1853349','1853350','1853351','1853352','1853353','1853354','1853355','1853356','3792998','1476861','1481262','1854208','1854209','1854210','1854211','1854212','1854213','1854214','1854216','3783713','1854215','1462766','1854183','1854184','1854185','1854186','1854217','1854218','1854219','1854220','1854221','1854222','1854224','1854225','1854226','1854227','1854228','1854229','1854230','1854231','1854223','1462817','1481849','3789214','3785213','1462799','1462800','3779454','4308263','1843854','1843856','1462814','1462813','1843706','1843707','1843708','1843709','1843710','1843711','1843712','1843713','1843714','1843732','1843715','1843716','1843717','1843718','1843719','1843720','1843721','1843722','1843723','1843724','1843725','1843726','1843727','1843728','1462812','1843729','1843730','1843731','1843882','1843883','1843884','1843885','1843886','1843887','1843888','1843889','1843890','1843891','1843892','1843893','1843894','1843895','1843896','1843897','1843898','1843899','1843900','1843901','1843902','1843903','1843904','1843905','1843906','1843907','1843908','1843909','1843910','1843911','1843912','1843913','1843914','1843915','1843916','1843917','1843918','1843919','1843920','1843921','1843922','1843923','1843924','1843925','1843926','1843927','1843928','1843929','1843930','1843931','1462811','1462801','3776547','1462802','1462803','1462809','1462804','1462805','1475091','1462808','1462498','1462497','1462807','1462594','3792968','1854072','1854073','1854074','1854075','1854076','1854081','1854077','1854078','1854079','1854080','1854380','1843648','1462589','1462587','3790575','1854373','1462571','1462586','1477506','1843585','1462496','1483496','1483281','1843587','1843588','1843589','1843590','1843591','1843592','1843593','1843594','1843595','1843596','1843597','1843598','1843599','1843600','1843601','1843602','1843603','1843604','1843605','1843606','1843607','1843608','1843609','1476941','1854122','1854123','1854124','1854125','1854126','1854117','1854118','1854119','1854120','1854121','1854111','1854110','1854109','1854108','1854107','1854116','1854115','1854114','1854113','1854112','1462573','1462583','1462584','3776307','1843610','1843611','1843612','1843613','1843614','1843615','1843616','1843617','1843618','1843619','1843620','1843621','1843622','1843623','1843624','1843625','1843626','1843627','1843628','1843629','1843630','1843631','1843702','1843696','1843701','1843704','1843703','1843697','1843683','1843698','1843699','1462493','1462491','1843643','1462490','1843644','1843661','1845931','1845930','1845929','1845928','1845927','1845926','1845925','1845924','1845923','1845922','1845921','1845920','1845919','1845918','1845917','1845916','1845915','1845914','1845913','1845912','1845911','1845910','1845909','1845908','1845907','1845906','1845905','1845904','1845903','1845902','1845901','1843666','1845900','1845899','1845898','1845897','1845896','1845895','1845894','1845893','1845892','1845891','1845890','1845889','1845888','1845887','1845886','1845885','1845884','1845883','1845882','1845981','1845980','1845979','1845978','1845977','1845976','1845975','1845974','1845973','1845972','1845971','1845970','1845969','1845968','1845967','1845966','1845965','1845964','1845963','1845962','1845961','1845960','1845959','1845958','1845957','1845956','1845955','1845954','1845953','1845952','1845951','1845950','1845949','1845948','1845947','1845946','1845945','1845944','1845943','1845942','1845941','1845940','1845939','1845938','1845937','1845936','1845935','1845934','1845933','1845932','1462486','1476389','1462741','1482132','1845799','1845800','1845801','1845802','1845803','1845804','1845805','1845806','1845807','1845808','1845761','1845762','1845763','1845764','1845765','1845766','1845767','1845768','1845769','1845770','1845771','1845772','1845773','1845774','1845775','1845776','1845777','1845778','1845779','1845780','1845781','1845782','1845783','1845784','1845785','1845786','1845787','1845788','1845789','1845790','1845791','1845792','1845793','1845794','1845795','1845796','1845797','1845798','1845809','1845810','1845811','1845812','1845813','1845814','1845815','1845816','1845817','1845818','1845819','1845820','1845821','1845822','1845823','1845824','1845826','1845827','1845828','1845830','1845831','1845832','1845833','1845834','1845835','1845836','1845837','1845838','1845839','1845841','1845842','1845843','1845844','1845846','1845847','1845848','1845849','1845850','1845851','1845852','1845853','1845854','1845855','1845866','1845872','1845873','1845874','1845875','1845876','1845877','1845878','1845879','1845880','1462487','1462592','2933844','2933887','2933888','2933889','2933890','2933862','2933863','2933864','2933865','2933867','2933868','2933869','2933870','2933871','2933872','2933873','2933874','2933875','2933876','2933877','2933878','2933879','2933880','2933881','2933882','2933883','2933884','2933885','2933886');

SELECT
  cards.uid,
  cards.next_recalc,
  balance_movements.is_positive,
  balance_movements.from_date,
  balance_movements.end_date
FROM cards
  INNER JOIN balance_movements on cards.id = balance_movements.card_id
WHERE cards.client_id = 625
      AND cards.id in ('1331702','1331811','1335207','1335564','1335668','1340440','1341623','1347628','1348794','1349569','1351839','1352340','1353943','1354155','1354533','1354637','1354778','1354797','1354801','1354821','1354855','1354882','1356797','1356809','1357028','1357057','1361978','1367523','1367614','1368365','1368472','1369752','1369971','1374855','1376936','1377632','1378731','1381074','1381108','1381111','1384072','1386172','1386294','1386369','1386408','1388300','1388775','1389569','1389577','1389585','1389591','1389597','1389598','1389617','1390583','1390589','1390599','1390606','1390608','1390617','1390619','1390655','1390659','1392389','1392786','1394038','1394377','1394488','1395378','1399152','1399173','1399597','1404109','1404801','1404875','1408729','1408888','1408891','1408905','1408918','1408968','1409979','1411862','1412430','1417737','1420786','1420959','1422794','1424277','1426968','1427123','1429503','1429854','1430452','1430869','1432391','1434188','1434396','1434488','1436873','1437020','1444494','1800130','1467765','1464251','1462402','1462840','1462829','1462873','1462869','1462868','1462856','1854916','1462859','1855827','1855985','1462866','1462894','1858158','1462886','1462883','1462876','1462930','1462918','1462948','1462947','1852683','1462973','1462955','1463025','1463030','1463033','1463068','1463072','1463093','1463085','1463099','1463173','1463166','1463218','1463239','2984194','1463209','2998249','3000258','3001758','1461153','1480928','3048704','3057945','1478365','3060302','1480094','3061865','3072105','3752854','1481156','3760183','3762336','1482371','3769265','1478921','3784971','3775422','3773301','3775326','3779125','3775416','3773679','3787537','3783439','3775562','1481421','3783629','3789302','1474072','3783759','1463224','1463225','3776947','3775498','3789612','1482995','3791237','3775407','1463226','1463227','1463249','1463289','1463290','1463291','1463292','1463293','1463294','1463295','1463296','1463297','1463298','1463250','1463251','1463252','1463253','1463254','1463255','1463256','1463319','1463320','1482219','1479566','1462794','1462795','1462796','1462797','1462798','1463300','1463301','1463302','1463303','1463304','1463305','1463306','1463307','1463308','1463309','1463310','1463262','1463263','1463264','1463265','1463266','1463267','1463268','1463269','1463270','1463271','1463272','1843833','1843834','1843836','1843837','1843838','1843839','1843840','1843841','1843842','1843843','1843844','1843845','1843846','1843847','1843848','1843849','1843850','1843851','3783663','1843765','1843878','1843835','1854279','1854280','1854281','1854276','1854277','1854278','1854272','1854273','1854274','1854275','1462758','3781153','1482688','1462754','1462755','1462756','1462757','1462749','1462750','1462751','1462752','1462753','1843876','1843875','1843874','1843873','1843872','1843871','1843870','1843869','1843868','1843867','1843866','1475343','1481411','3773465','1462450','1482693','1462748','1843853','1843760','1843782','1843772','1843771','1843770','1843769','1843768','1843742','1843741','1843740','1843736','1843735','1843734','1843733','1843743','1843744','1843738','1843764','1843737','1843739','1843758','1843750','1843749','1843755','1843754','3783269','1854357','1854358','1854359','1854360','1854361','1854362','1854363','1854364','1854365','1854366','1462745','1462721','1462547','1462722','1462723','1462724','1462725','1462727','1462729','1462728','1462726','1462768','1481627','1843757','1843756','1843753','1843751','1843752','1843781','1843746','1843767','1843745','1843778','1843759','1843779','1843766','1843762','1843763','1843761','1843776','1843775','1843774','1843773','1843777','1843747','1843748','1843780','1462760','1474172','3780201','1472198','1472199','1472200','1472201','1472202','1472203','1472112','1472113','1472114','1472115','1472116','1472117','1472118','1472119','1472120','1472121','1472122','1472123','1472124','1472125','1472126','1472127','1472128','1472129','1472130','1472131','1472132','1472133','1472134','1472135','1472136','1472137','1472138','1472139','1472140','1472141','1472142','1472143','1472144','1472145','1472146','1472147','1472148','1472149','1472150','1472151','1472152','1472153','1472154','1472155','1472156','1472157','1472158','1472159','1472160','1472161','1472162','1472163','1472164','1472165','1472166','1472167','1472168','1472169','1472170','1472171','1472172','1472173','1472174','1472175','1472176','1472177','1472178','1472179','1472180','1472181','1472182','1472183','1472184','1472185','1472186','1472187','1472188','1472189','1472190','1472191','1472192','1472193','1472194','1472195','1472196','1472197','1472204','1472205','1472206','1472207','1472208','1472209','1472210','1472211','1472212','1472248','1472249','1472250','1472251','1472252','1472253','1472254','1472255','1472256','1472257','1472258','1472259','1472260','1472261','1472262','1472263','1472264','1472265','1472266','1472267','1472268','1472269','1472270','1472271','1472298','1472299','1472300','1472301','1472302','1472303','1472304','1472305','1472306','1472307','1472308','1472309','1472310','1472311','1472312','1472313','1472314','1472315','1472316','1472317','1472318','1472319','1472320','1472321','1472322','1841102','1841103','1841104','1841105','1841106','1841107','1841108','1841109','1841110','1841111','1841112','1841113','1841114','1841115','1841116','1841117','1841118','1841119','1841120','1841121','1841122','1841123','1841124','1841125','1841126','1841127','1841128','1841129','1841130','1841131','1841132','1841133','1841134','1841135','1841136','1841137','1841138','1841139','1841140','1841141','1841142','1841143','1841144','1841145','1841146','1841147','1841148','1841149','1841150','1841151','1841865','1841866','1841867','1841868','1841869','1841870','1841871','1841872','1841873','1841874','1841875','1841876','1841877','1841878','1841879','1841880','1841881','1841882','1841883','1841884','1841885','1841886','1841887','1841888','1841889','1841890','1841891','1841892','1841893','1841894','1841895','1841896','1841897','1841898','1841899','1841900','1841901','1841902','1841903','1841904','1841905','1841906','1841907','1841908','1841909','1841910','1841911','1841912','1841913','1841914','1846910','1846911','1846912','1846913','1846914','1846915','1846916','1846917','1846918','1846919','1846920','1846921','1846922','1846923','1846924','1846925','1846926','1846927','1846928','1846929','1846930','1846931','1846932','1846933','1846934','1846935','1846936','1846937','1846938','1846939','1846940','1846941','1846942','1846943','1846944','1846945','1846952','1846953','1846954','1846955','1846956','1846957','1846958','1846959','1846960','1846961','1846962','1846963','1847022','1847094','1849481','1849482','1849483','1849484','1849485','1849486','1849487','1849488','1849489','1849490','1849491','1849492','1849493','1849494','1849495','1849496','1849497','1849498','1849499','1849500','1849501','1849502','1849503','1849504','1849505','1849506','1849507','1849508','1849509','1849510','1849511','1849512','1849513','1849514','1849515','1849516','1849517','1849518','1849519','1849520','1849521','1849522','1849523','1849524','1849577','1849578','1849579','1849580','1849581','1849741','1849826','1849827','1849828','1849875','1849876','1849879','1849880','1849881','1849882','1849883','1849885','1849886','1849887','1849888','1849889','1849890','1849891','1849894','1849900','1849901','1849903','1849904','1849905','1849907','1849908','1849909','1849910','1849911','1849912','1849913','1849914','1849915','1849916','1849917','1849918','1849919','1849920','1849921','1849922','1849923','1849924','1849925','1849926','1849927','1849928','1849929','1849930','1849931','1849938','1853882','1853883','1853884','1853885','1853886','1853887','1853888','1853889','1853890','1853891','1853892','1853893','1853894','1853895','1853896','1853897','1853898','1853899','1853900','1853901','1853902','1853903','1853904','1853905','1853906','1853907','1853908','1853909','1853910','1853911','1853912','1853913','1853914','1853915','1853916','1853917','1853918','1853919','1853920','1853921','1853922','1853923','1853924','1853925','1853926','1853927','1853928','1853929','1853930','1853931','1853932','1853933','1853934','1853935','1853936','1853937','1853938','1853939','1853940','1853941','1853942','1853943','1853944','1853945','1853946','1853947','1853948','1853949','1853950','1853951','1853952','1853953','1853954','1853955','1853956','1853957','1853958','1853959','1853960','1853961','1853962','1853963','1853964','1853965','1853966','1853967','1853968','1853969','1853970','1853971','1853972','1853973','1853974','1853975','1853976','1853977','1853978','1853979','1853980','1853981','3779976','3786747','1476634','1462762','1843932','1843933','1843934','1843935','1843936','1843937','1843938','1843939','1843940','1843941','1843942','1843943','1843944','1843945','1843946','1843981','1843862','1843947','1843948','1843949','1843950','1843951','1843952','1843953','1843954','1843955','1843956','1843957','1843958','1843959','1843960','1843961','1843962','1843963','1843964','1843965','1843966','1843967','1843968','1843969','1843970','1843971','1843972','1843973','1843974','1843975','1843976','1843977','1843978','1843979','1843980','1462763','1462734','1462733','1462732','1462731','1462730','1462739','1462738','1462737','1462736','1462331','1462524','1462525','1462526','1462527','1462528','1462529','1462530','1462531','1462532','1462533','1462534','1462535','1462536','1462537','1462538','1462539','1462540','1462541','1462542','1462543','1462544','1462545','1462546','1462549','1462550','1462551','1462552','1462553','1462554','1462555','1462556','1462557','1462558','1462559','1462620','1462621','1462622','1462623','1462624','1462625','1462626','1462627','1462628','1462629','1462630','1462631','1462632','1462633','1462634','1462635','1462636','1462637','1462638','1462639','1462640','1462641','1462642','1462643','1462644','1462670','1462671','1462672','1462673','1462674','1462675','1462676','1462677','1462678','1462679','1462680','1462681','1462682','1462683','1462684','1462685','1462686','1462687','1462688','1462689','1462690','1462691','1462692','1462693','1462694','1462695','1462696','1462697','1462698','1462699','1462700','1462701','1462702','1462703','1462704','1462705','1462706','1462707','1462708','1462709','1462710','1462711','1462712','1462713','1462714','1462715','1462716','1462717','1462718','1462769','1462770','1462771','1462772','1462773','1462774','1462775','1462776','1462777','1462778','1462779','1462780','1462781','1462782','1462783','1462784','1462785','1462786','1462787','1462788','1462789','1462790','1462791','1462792','1462793','1462819','1462820','1462821','1462822','1462823','1472448','1472449','1472450','1472451','1472452','1472453','1472454','1472455','1472456','1472457','1472458','1472459','1472460','1472461','1472462','1472463','1472464','1472465','1472466','1472467','1472468','1472469','1472470','1472471','1472472','1472498','1472499','1472500','1472501','1472502','1472503','1472504','1472505','1472506','1472507','1472508','1472509','1472510','1472511','1472512','1472513','1472514','1472515','1472516','1472517','1472518','1472519','1472520','1472521','1843582','1843783','1843784','1843785','1843786','1843787','1843788','1843789','1843790','1843791','1843792','1843793','1843794','1843795','1843796','1843797','1843798','1843799','1843800','1843801','1843802','1843803','1843804','1843805','1843806','1843807','1843808','1843809','1843810','1843811','1843812','1843813','1843814','1843815','1843816','1843817','1843818','1843819','1843820','1843821','1843822','1843823','1843824','1843825','1843826','1843827','1843828','1843829','1843830','1843831','1849232','1849233','1849234','1849235','1849236','1849237','1849238','1849239','1849240','1849241','1849242','1849243','1849244','1849245','1849246','1849247','1849249','1849250','1849251','1849252','1849253','1849254','1849255','1849256','1849257','1849258','1849259','1849260','1849261','1849262','1849263','1849264','1849265','1849266','1849267','1849268','1849269','1849270','1849271','1849272','1849273','1849274','1849275','1849276','1849277','1849278','1849279','1849280','1849281','1853282','1853283','1853284','1853285','1853286','1853287','1853288','1853289','1853290','1853291','1853292','1853293','1853294','1853295','1853296','1853297','1853298','1853299','1853300','1853301','1853302','1853303','1853304','1853305','1853306','1853332','1853333','1853334','1853335','1853336','1853337','1853338','1853339','1853340','1853341','1853342','1853343','1853344','1853345','1853346','1853347','1853348','1853349','1853350','1853351','1853352','1853353','1853354','1853355','1853356','3792998','1476861','1481262','1854208','1854209','1854210','1854211','1854212','1854213','1854214','1854216','3783713','1854215','1462766','1854183','1854184','1854185','1854186','1854217','1854218','1854219','1854220','1854221','1854222','1854224','1854225','1854226','1854227','1854228','1854229','1854230','1854231','1854223','1462817','1481849','3789214','3785213','1462799','1462800','3779454','4308263','1843854','1843856','1462814','1462813','1843706','1843707','1843708','1843709','1843710','1843711','1843712','1843713','1843714','1843732','1843715','1843716','1843717','1843718','1843719','1843720','1843721','1843722','1843723','1843724','1843725','1843726','1843727','1843728','1462812','1843729','1843730','1843731','1843882','1843883','1843884','1843885','1843886','1843887','1843888','1843889','1843890','1843891','1843892','1843893','1843894','1843895','1843896','1843897','1843898','1843899','1843900','1843901','1843902','1843903','1843904','1843905','1843906','1843907','1843908','1843909','1843910','1843911','1843912','1843913','1843914','1843915','1843916','1843917','1843918','1843919','1843920','1843921','1843922','1843923','1843924','1843925','1843926','1843927','1843928','1843929','1843930','1843931','1462811','1462801','3776547','1462802','1462803','1462809','1462804','1462805','1475091','1462808','1462498','1462497','1462807','1462594','3792968','1854072','1854073','1854074','1854075','1854076','1854081','1854077','1854078','1854079','1854080','1854380','1843648','1462589','1462587','3790575','1854373','1462571','1462586','1477506','1843585','1462496','1483496','1483281','1843587','1843588','1843589','1843590','1843591','1843592','1843593','1843594','1843595','1843596','1843597','1843598','1843599','1843600','1843601','1843602','1843603','1843604','1843605','1843606','1843607','1843608','1843609','1476941','1854122','1854123','1854124','1854125','1854126','1854117','1854118','1854119','1854120','1854121','1854111','1854110','1854109','1854108','1854107','1854116','1854115','1854114','1854113','1854112','1462573','1462583','1462584','3776307','1843610','1843611','1843612','1843613','1843614','1843615','1843616','1843617','1843618','1843619','1843620','1843621','1843622','1843623','1843624','1843625','1843626','1843627','1843628','1843629','1843630','1843631','1843702','1843696','1843701','1843704','1843703','1843697','1843683','1843698','1843699','1462493','1462491','1843643','1462490','1843644','1843661','1845931','1845930','1845929','1845928','1845927','1845926','1845925','1845924','1845923','1845922','1845921','1845920','1845919','1845918','1845917','1845916','1845915','1845914','1845913','1845912','1845911','1845910','1845909','1845908','1845907','1845906','1845905','1845904','1845903','1845902','1845901','1843666','1845900','1845899','1845898','1845897','1845896','1845895','1845894','1845893','1845892','1845891','1845890','1845889','1845888','1845887','1845886','1845885','1845884','1845883','1845882','1845981','1845980','1845979','1845978','1845977','1845976','1845975','1845974','1845973','1845972','1845971','1845970','1845969','1845968','1845967','1845966','1845965','1845964','1845963','1845962','1845961','1845960','1845959','1845958','1845957','1845956','1845955','1845954','1845953','1845952','1845951','1845950','1845949','1845948','1845947','1845946','1845945','1845944','1845943','1845942','1845941','1845940','1845939','1845938','1845937','1845936','1845935','1845934','1845933','1845932','1462486','1476389','1462741','1482132','1845799','1845800','1845801','1845802','1845803','1845804','1845805','1845806','1845807','1845808','1845761','1845762','1845763','1845764','1845765','1845766','1845767','1845768','1845769','1845770','1845771','1845772','1845773','1845774','1845775','1845776','1845777','1845778','1845779','1845780','1845781','1845782','1845783','1845784','1845785','1845786','1845787','1845788','1845789','1845790','1845791','1845792','1845793','1845794','1845795','1845796','1845797','1845798','1845809','1845810','1845811','1845812','1845813','1845814','1845815','1845816','1845817','1845818','1845819','1845820','1845821','1845822','1845823','1845824','1845826','1845827','1845828','1845830','1845831','1845832','1845833','1845834','1845835','1845836','1845837','1845838','1845839','1845841','1845842','1845843','1845844','1845846','1845847','1845848','1845849','1845850','1845851','1845852','1845853','1845854','1845855','1845866','1845872','1845873','1845874','1845875','1845876','1845877','1845878','1845879','1845880','1462487','1462592','2933844','2933887','2933888','2933889','2933890','2933862','2933863','2933864','2933865','2933867','2933868','2933869','2933870','2933871','2933872','2933873','2933874','2933875','2933876','2933877','2933878','2933879','2933880','2933881','2933882','2933883','2933884','2933885','2933886')
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1
GROUP BY balance_movements.id;

SELECT
  cards.id,
  cards.uid,
  cards.balance,
  goods_incomes.bonus_add
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  LEFT OUTER JOIN goods_incomes ON goods_incomes.order_id = orders.id
WHERE cards.client_id = 625
      AND cards.id in ('1331702','1331811','1335207','1335564','1335668','1340440','1341623','1347628','1348794','1349569','1351839','1352340','1353943','1354155','1354533','1354637','1354778','1354797','1354801','1354821','1354855','1354882','1356797','1356809','1357028','1357057','1361978','1367523','1367614','1368365','1368472','1369752','1369971','1374855','1376936','1377632','1378731','1381074','1381108','1381111','1384072','1386172','1386294','1386369','1386408','1388300','1388775','1389569','1389577','1389585','1389591','1389597','1389598','1389617','1390583','1390589','1390599','1390606','1390608','1390617','1390619','1390655','1390659','1392389','1392786','1394038','1394377','1394488','1395378','1399152','1399173','1399597','1404109','1404801','1404875','1408729','1408888','1408891','1408905','1408918','1408968','1409979','1411862','1412430','1417737','1420786','1420959','1422794','1424277','1426968','1427123','1429503','1429854','1430452','1430869','1432391','1434188','1434396','1434488','1436873','1437020','1444494','1800130','1467765','1464251','1462402','1462840','1462829','1462873','1462869','1462868','1462856','1854916','1462859','1855827','1855985','1462866','1462894','1858158','1462886','1462883','1462876','1462930','1462918','1462948','1462947','1852683','1462973','1462955','1463025','1463030','1463033','1463068','1463072','1463093','1463085','1463099','1463173','1463166','1463218','1463239','2984194','1463209','2998249','3000258','3001758','1461153','1480928','3048704','3057945','1478365','3060302','1480094','3061865','3072105','3752854','1481156','3760183','3762336','1482371','3769265','1478921','3784971','3775422','3773301','3775326','3779125','3775416','3773679','3787537','3783439','3775562','1481421','3783629','3789302','1474072','3783759','1463224','1463225','3776947','3775498','3789612','1482995','3791237','3775407','1463226','1463227','1463249','1463289','1463290','1463291','1463292','1463293','1463294','1463295','1463296','1463297','1463298','1463250','1463251','1463252','1463253','1463254','1463255','1463256','1463319','1463320','1482219','1479566','1462794','1462795','1462796','1462797','1462798','1463300','1463301','1463302','1463303','1463304','1463305','1463306','1463307','1463308','1463309','1463310','1463262','1463263','1463264','1463265','1463266','1463267','1463268','1463269','1463270','1463271','1463272','1843833','1843834','1843836','1843837','1843838','1843839','1843840','1843841','1843842','1843843','1843844','1843845','1843846','1843847','1843848','1843849','1843850','1843851','3783663','1843765','1843878','1843835','1854279','1854280','1854281','1854276','1854277','1854278','1854272','1854273','1854274','1854275','1462758','3781153','1482688','1462754','1462755','1462756','1462757','1462749','1462750','1462751','1462752','1462753','1843876','1843875','1843874','1843873','1843872','1843871','1843870','1843869','1843868','1843867','1843866','1475343','1481411','3773465','1462450','1482693','1462748','1843853','1843760','1843782','1843772','1843771','1843770','1843769','1843768','1843742','1843741','1843740','1843736','1843735','1843734','1843733','1843743','1843744','1843738','1843764','1843737','1843739','1843758','1843750','1843749','1843755','1843754','3783269','1854357','1854358','1854359','1854360','1854361','1854362','1854363','1854364','1854365','1854366','1462745','1462721','1462547','1462722','1462723','1462724','1462725','1462727','1462729','1462728','1462726','1462768','1481627','1843757','1843756','1843753','1843751','1843752','1843781','1843746','1843767','1843745','1843778','1843759','1843779','1843766','1843762','1843763','1843761','1843776','1843775','1843774','1843773','1843777','1843747','1843748','1843780','1462760','1474172','3780201','1472198','1472199','1472200','1472201','1472202','1472203','1472112','1472113','1472114','1472115','1472116','1472117','1472118','1472119','1472120','1472121','1472122','1472123','1472124','1472125','1472126','1472127','1472128','1472129','1472130','1472131','1472132','1472133','1472134','1472135','1472136','1472137','1472138','1472139','1472140','1472141','1472142','1472143','1472144','1472145','1472146','1472147','1472148','1472149','1472150','1472151','1472152','1472153','1472154','1472155','1472156','1472157','1472158','1472159','1472160','1472161','1472162','1472163','1472164','1472165','1472166','1472167','1472168','1472169','1472170','1472171','1472172','1472173','1472174','1472175','1472176','1472177','1472178','1472179','1472180','1472181','1472182','1472183','1472184','1472185','1472186','1472187','1472188','1472189','1472190','1472191','1472192','1472193','1472194','1472195','1472196','1472197','1472204','1472205','1472206','1472207','1472208','1472209','1472210','1472211','1472212','1472248','1472249','1472250','1472251','1472252','1472253','1472254','1472255','1472256','1472257','1472258','1472259','1472260','1472261','1472262','1472263','1472264','1472265','1472266','1472267','1472268','1472269','1472270','1472271','1472298','1472299','1472300','1472301','1472302','1472303','1472304','1472305','1472306','1472307','1472308','1472309','1472310','1472311','1472312','1472313','1472314','1472315','1472316','1472317','1472318','1472319','1472320','1472321','1472322','1841102','1841103','1841104','1841105','1841106','1841107','1841108','1841109','1841110','1841111','1841112','1841113','1841114','1841115','1841116','1841117','1841118','1841119','1841120','1841121','1841122','1841123','1841124','1841125','1841126','1841127','1841128','1841129','1841130','1841131','1841132','1841133','1841134','1841135','1841136','1841137','1841138','1841139','1841140','1841141','1841142','1841143','1841144','1841145','1841146','1841147','1841148','1841149','1841150','1841151','1841865','1841866','1841867','1841868','1841869','1841870','1841871','1841872','1841873','1841874','1841875','1841876','1841877','1841878','1841879','1841880','1841881','1841882','1841883','1841884','1841885','1841886','1841887','1841888','1841889','1841890','1841891','1841892','1841893','1841894','1841895','1841896','1841897','1841898','1841899','1841900','1841901','1841902','1841903','1841904','1841905','1841906','1841907','1841908','1841909','1841910','1841911','1841912','1841913','1841914','1846910','1846911','1846912','1846913','1846914','1846915','1846916','1846917','1846918','1846919','1846920','1846921','1846922','1846923','1846924','1846925','1846926','1846927','1846928','1846929','1846930','1846931','1846932','1846933','1846934','1846935','1846936','1846937','1846938','1846939','1846940','1846941','1846942','1846943','1846944','1846945','1846952','1846953','1846954','1846955','1846956','1846957','1846958','1846959','1846960','1846961','1846962','1846963','1847022','1847094','1849481','1849482','1849483','1849484','1849485','1849486','1849487','1849488','1849489','1849490','1849491','1849492','1849493','1849494','1849495','1849496','1849497','1849498','1849499','1849500','1849501','1849502','1849503','1849504','1849505','1849506','1849507','1849508','1849509','1849510','1849511','1849512','1849513','1849514','1849515','1849516','1849517','1849518','1849519','1849520','1849521','1849522','1849523','1849524','1849577','1849578','1849579','1849580','1849581','1849741','1849826','1849827','1849828','1849875','1849876','1849879','1849880','1849881','1849882','1849883','1849885','1849886','1849887','1849888','1849889','1849890','1849891','1849894','1849900','1849901','1849903','1849904','1849905','1849907','1849908','1849909','1849910','1849911','1849912','1849913','1849914','1849915','1849916','1849917','1849918','1849919','1849920','1849921','1849922','1849923','1849924','1849925','1849926','1849927','1849928','1849929','1849930','1849931','1849938','1853882','1853883','1853884','1853885','1853886','1853887','1853888','1853889','1853890','1853891','1853892','1853893','1853894','1853895','1853896','1853897','1853898','1853899','1853900','1853901','1853902','1853903','1853904','1853905','1853906','1853907','1853908','1853909','1853910','1853911','1853912','1853913','1853914','1853915','1853916','1853917','1853918','1853919','1853920','1853921','1853922','1853923','1853924','1853925','1853926','1853927','1853928','1853929','1853930','1853931','1853932','1853933','1853934','1853935','1853936','1853937','1853938','1853939','1853940','1853941','1853942','1853943','1853944','1853945','1853946','1853947','1853948','1853949','1853950','1853951','1853952','1853953','1853954','1853955','1853956','1853957','1853958','1853959','1853960','1853961','1853962','1853963','1853964','1853965','1853966','1853967','1853968','1853969','1853970','1853971','1853972','1853973','1853974','1853975','1853976','1853977','1853978','1853979','1853980','1853981','3779976','3786747','1476634','1462762','1843932','1843933','1843934','1843935','1843936','1843937','1843938','1843939','1843940','1843941','1843942','1843943','1843944','1843945','1843946','1843981','1843862','1843947','1843948','1843949','1843950','1843951','1843952','1843953','1843954','1843955','1843956','1843957','1843958','1843959','1843960','1843961','1843962','1843963','1843964','1843965','1843966','1843967','1843968','1843969','1843970','1843971','1843972','1843973','1843974','1843975','1843976','1843977','1843978','1843979','1843980','1462763','1462734','1462733','1462732','1462731','1462730','1462739','1462738','1462737','1462736','1462331','1462524','1462525','1462526','1462527','1462528','1462529','1462530','1462531','1462532','1462533','1462534','1462535','1462536','1462537','1462538','1462539','1462540','1462541','1462542','1462543','1462544','1462545','1462546','1462549','1462550','1462551','1462552','1462553','1462554','1462555','1462556','1462557','1462558','1462559','1462620','1462621','1462622','1462623','1462624','1462625','1462626','1462627','1462628','1462629','1462630','1462631','1462632','1462633','1462634','1462635','1462636','1462637','1462638','1462639','1462640','1462641','1462642','1462643','1462644','1462670','1462671','1462672','1462673','1462674','1462675','1462676','1462677','1462678','1462679','1462680','1462681','1462682','1462683','1462684','1462685','1462686','1462687','1462688','1462689','1462690','1462691','1462692','1462693','1462694','1462695','1462696','1462697','1462698','1462699','1462700','1462701','1462702','1462703','1462704','1462705','1462706','1462707','1462708','1462709','1462710','1462711','1462712','1462713','1462714','1462715','1462716','1462717','1462718','1462769','1462770','1462771','1462772','1462773','1462774','1462775','1462776','1462777','1462778','1462779','1462780','1462781','1462782','1462783','1462784','1462785','1462786','1462787','1462788','1462789','1462790','1462791','1462792','1462793','1462819','1462820','1462821','1462822','1462823','1472448','1472449','1472450','1472451','1472452','1472453','1472454','1472455','1472456','1472457','1472458','1472459','1472460','1472461','1472462','1472463','1472464','1472465','1472466','1472467','1472468','1472469','1472470','1472471','1472472','1472498','1472499','1472500','1472501','1472502','1472503','1472504','1472505','1472506','1472507','1472508','1472509','1472510','1472511','1472512','1472513','1472514','1472515','1472516','1472517','1472518','1472519','1472520','1472521','1843582','1843783','1843784','1843785','1843786','1843787','1843788','1843789','1843790','1843791','1843792','1843793','1843794','1843795','1843796','1843797','1843798','1843799','1843800','1843801','1843802','1843803','1843804','1843805','1843806','1843807','1843808','1843809','1843810','1843811','1843812','1843813','1843814','1843815','1843816','1843817','1843818','1843819','1843820','1843821','1843822','1843823','1843824','1843825','1843826','1843827','1843828','1843829','1843830','1843831','1849232','1849233','1849234','1849235','1849236','1849237','1849238','1849239','1849240','1849241','1849242','1849243','1849244','1849245','1849246','1849247','1849249','1849250','1849251','1849252','1849253','1849254','1849255','1849256','1849257','1849258','1849259','1849260','1849261','1849262','1849263','1849264','1849265','1849266','1849267','1849268','1849269','1849270','1849271','1849272','1849273','1849274','1849275','1849276','1849277','1849278','1849279','1849280','1849281','1853282','1853283','1853284','1853285','1853286','1853287','1853288','1853289','1853290','1853291','1853292','1853293','1853294','1853295','1853296','1853297','1853298','1853299','1853300','1853301','1853302','1853303','1853304','1853305','1853306','1853332','1853333','1853334','1853335','1853336','1853337','1853338','1853339','1853340','1853341','1853342','1853343','1853344','1853345','1853346','1853347','1853348','1853349','1853350','1853351','1853352','1853353','1853354','1853355','1853356','3792998','1476861','1481262','1854208','1854209','1854210','1854211','1854212','1854213','1854214','1854216','3783713','1854215','1462766','1854183','1854184','1854185','1854186','1854217','1854218','1854219','1854220','1854221','1854222','1854224','1854225','1854226','1854227','1854228','1854229','1854230','1854231','1854223','1462817','1481849','3789214','3785213','1462799','1462800','3779454','4308263','1843854','1843856','1462814','1462813','1843706','1843707','1843708','1843709','1843710','1843711','1843712','1843713','1843714','1843732','1843715','1843716','1843717','1843718','1843719','1843720','1843721','1843722','1843723','1843724','1843725','1843726','1843727','1843728','1462812','1843729','1843730','1843731','1843882','1843883','1843884','1843885','1843886','1843887','1843888','1843889','1843890','1843891','1843892','1843893','1843894','1843895','1843896','1843897','1843898','1843899','1843900','1843901','1843902','1843903','1843904','1843905','1843906','1843907','1843908','1843909','1843910','1843911','1843912','1843913','1843914','1843915','1843916','1843917','1843918','1843919','1843920','1843921','1843922','1843923','1843924','1843925','1843926','1843927','1843928','1843929','1843930','1843931','1462811','1462801','3776547','1462802','1462803','1462809','1462804','1462805','1475091','1462808','1462498','1462497','1462807','1462594','3792968','1854072','1854073','1854074','1854075','1854076','1854081','1854077','1854078','1854079','1854080','1854380','1843648','1462589','1462587','3790575','1854373','1462571','1462586','1477506','1843585','1462496','1483496','1483281','1843587','1843588','1843589','1843590','1843591','1843592','1843593','1843594','1843595','1843596','1843597','1843598','1843599','1843600','1843601','1843602','1843603','1843604','1843605','1843606','1843607','1843608','1843609','1476941','1854122','1854123','1854124','1854125','1854126','1854117','1854118','1854119','1854120','1854121','1854111','1854110','1854109','1854108','1854107','1854116','1854115','1854114','1854113','1854112','1462573','1462583','1462584','3776307','1843610','1843611','1843612','1843613','1843614','1843615','1843616','1843617','1843618','1843619','1843620','1843621','1843622','1843623','1843624','1843625','1843626','1843627','1843628','1843629','1843630','1843631','1843702','1843696','1843701','1843704','1843703','1843697','1843683','1843698','1843699','1462493','1462491','1843643','1462490','1843644','1843661','1845931','1845930','1845929','1845928','1845927','1845926','1845925','1845924','1845923','1845922','1845921','1845920','1845919','1845918','1845917','1845916','1845915','1845914','1845913','1845912','1845911','1845910','1845909','1845908','1845907','1845906','1845905','1845904','1845903','1845902','1845901','1843666','1845900','1845899','1845898','1845897','1845896','1845895','1845894','1845893','1845892','1845891','1845890','1845889','1845888','1845887','1845886','1845885','1845884','1845883','1845882','1845981','1845980','1845979','1845978','1845977','1845976','1845975','1845974','1845973','1845972','1845971','1845970','1845969','1845968','1845967','1845966','1845965','1845964','1845963','1845962','1845961','1845960','1845959','1845958','1845957','1845956','1845955','1845954','1845953','1845952','1845951','1845950','1845949','1845948','1845947','1845946','1845945','1845944','1845943','1845942','1845941','1845940','1845939','1845938','1845937','1845936','1845935','1845934','1845933','1845932','1462486','1476389','1462741','1482132','1845799','1845800','1845801','1845802','1845803','1845804','1845805','1845806','1845807','1845808','1845761','1845762','1845763','1845764','1845765','1845766','1845767','1845768','1845769','1845770','1845771','1845772','1845773','1845774','1845775','1845776','1845777','1845778','1845779','1845780','1845781','1845782','1845783','1845784','1845785','1845786','1845787','1845788','1845789','1845790','1845791','1845792','1845793','1845794','1845795','1845796','1845797','1845798','1845809','1845810','1845811','1845812','1845813','1845814','1845815','1845816','1845817','1845818','1845819','1845820','1845821','1845822','1845823','1845824','1845826','1845827','1845828','1845830','1845831','1845832','1845833','1845834','1845835','1845836','1845837','1845838','1845839','1845841','1845842','1845843','1845844','1845846','1845847','1845848','1845849','1845850','1845851','1845852','1845853','1845854','1845855','1845866','1845872','1845873','1845874','1845875','1845876','1845877','1845878','1845879','1845880','1462487','1462592','2933844','2933887','2933888','2933889','2933890','2933862','2933863','2933864','2933865','2933867','2933868','2933869','2933870','2933871','2933872','2933873','2933874','2933875','2933876','2933877','2933878','2933879','2933880','2933881','2933882','2933883','2933884','2933885','2933886')
      AND orders.`from` >= '2020.11.26'
      AND orders.`from` <= '2020.12.25 23:59:59'
      AND goods_incomes.bonus_add > 0
GROUP BY orders.id;


/*
По приведенным ниже артикулам, необходимо выгрузить кол-во купленных чашек всего за период с 14.12-20.12

017811
017812
017813
017814
015912
016163
016172
016074
021662


Саша, по этим данным нужно выгрузить 52 неделю в понедельник.
*/


SELECT
  cup.article,
  count(cup.id)
FROM cards
  INNER JOIN (
               SELECT
                 orders.*,
                 goods.article
               FROM orders
                 INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 INNER JOIN goods ON goods.id = goods_incomes.goods_id
               WHERE orders.client_id = 625
                     AND orders.from >= '2020-12-21'
                     AND orders.from <= '2020-12-27 23:59:59'
                     AND goods.article IN (
                 '017811',
                 '017812',
                 '017813',
                 '017814',
                 '015912',
                 '016163',
                 '016172',
                 '016074',
                 '021662'
               )
             ) AS cup ON cup.card_id = cards.id
WHERE cards.client_id = 625
GROUP BY cup.article;


/*
У АЗС есть списки клиентов "Monopoly", "Monopoly2", 1ДТ_РОЗНИЦА".

С 26.11 у данных клиентов наложились программы лояльности ( действовала и скидочная и бонусная система" .

Вопрос: Можно у этих  клиентов с 26.11-25.12 списать все начисленные бонусы за этот период?
*/

/*
1616
1669
1661
*/
UPDATE balance_movements
SET balance_movements.end_date = NOW()
where balance_movements.card_id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1;

UPDATE cards
SET cards.next_recalc = NOW()
where cards.id in ();

SELECT
  cards.uid,
  cards.next_recalc,
  balance_movements.is_positive,
  balance_movements.from_date,
  balance_movements.end_date
FROM cards
  INNER JOIN balance_movements on cards.id = balance_movements.card_id
WHERE cards.client_id = 625
      AND cards.id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1
GROUP BY balance_movements.id;

SELECT
  cards.id,
  cards.uid,
  cards.balance,
  goods_incomes.bonus_add
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  LEFT OUTER JOIN goods_incomes ON goods_incomes.order_id = orders.id
WHERE cards.client_id = 625
      AND cards.id in ()
      AND orders.`from` >= '2020.11.26'
      AND orders.`from` <= '2020.12.25 23:59:59'
      AND goods_incomes.bonus_add > 0
GROUP BY orders.id;

/*
Необходимо выгрузить в таблицу excel клиентов, которые зарегистрировались с 7.10 -29.12:

1) Регион (название группы магазинов)
2) Магазин
3)ФИО
4)Номер телефона
5) Дата регистрации.

Регион можно посмотреть в структуре личного кабинета ( Отчеты-->Продажи-->Структура). Пример выгрузки во вложении
*/

SELECT
  shops.name as shopName,
  profiles.name,
  profiles.phone,
  shops.id as shopID,
  hpc.created_at
FROM cards
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN shops ON orders.shop_id = shops.id
  LEFT OUTER JOIN (
                    SELECT *
                    FROM history_profiles_change
                    WHERE client_id = 888
                          AND is_creation = TRUE
                  ) AS hpc ON hpc.profile_id = profiles.id
WHERE cards.client_id = 888
  and hpc.created_at >= '2020-10-07'
  and hpc.created_at <= '2020-12-29 23:59:59'
GROUP BY cards.id;


SELECT *
FROM cards
WHERE cards.client_id = 888
      AND cards.uid = '79171332415';

/*
Привязкать телефон к личному кабинету
*

select * from goods
where goods.client_id = 1004;

*/

/*
Декорадо 780
 */

SELECT *
FROM goods
WHERE goods.client_id = 780;

SELECT *
FROM goods_categories
WHERE client_id = 780;

/*3735*/

SELECT *
FROM bills
WHERE id = 3735;

UPDATE bills
SET bills.exported = 1
WHERE bills.id = 3735;


/*
У АЗС есть списки клиентов "Monopoly", "Monopoly2", 1ДТ_РОЗНИЦА".

С 26.11 у данных клиентов наложились программы лояльности ( действовала и скидочная и бонусная система" .

Вопрос: Можно у этих  клиентов с 26.11-25.12 списать все начисленные бонусы за этот период?
*/

/*
1616
1669
1661
*/

SELECT *
FROM buyer_lists
WHERE client_id = 625
      AND name = '1ДТ_РОЗНИЦА';

SELECT buyers_list.buyers
FROM buyers_list
WHERE buyer_list_id = 1661;

SELECT cards.id
FROM cards
  INNER JOIN profiles ON cards.id = profiles.card_id
WHERE cards.client_id = 625
      AND profile_id IN (123);


UPDATE balance_movements
SET balance_movements.end_date = NOW()
where balance_movements.card_id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1;

UPDATE cards
SET cards.next_recalc = NOW()
where cards.id in ();

SELECT
  cards.uid,
  cards.next_recalc,
  balance_movements.is_positive,
  balance_movements.from_date,
  balance_movements.end_date
FROM cards
  INNER JOIN balance_movements on cards.id = balance_movements.card_id
WHERE cards.client_id = 625
      AND cards.id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1
GROUP BY balance_movements.id;

SELECT
  cards.id,
  cards.uid,
  cards.balance,
  goods_incomes.bonus_add
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  LEFT OUTER JOIN goods_incomes ON goods_incomes.order_id = orders.id
WHERE cards.client_id = 625
      AND cards.id in (123)
      AND orders.`from` >= '2020.11.26'
      AND orders.`from` <= '2020.12.25 23:59:59'
      AND goods_incomes.bonus_add > 0
GROUP BY orders.id;


/*
По приведенным ниже артикулам, необходимо выгрузить кол-во купленных чашек всего за период с 14.12-20.12

017811
017812
017813
017814
015912
016163
016172
016074
021662


Саша, по этим данным нужно выгрузить 51 неделю в понедельник.
*/


SELECT
  good.article,
  count(good.id)
FROM cards
  INNER JOIN (
               SELECT
                 orders.*,
                 goods.article
               FROM orders
                 INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 INNER JOIN goods ON goods.id = goods_incomes.goods_id
               WHERE orders.client_id = 625
                     AND orders.from >= '2020-12-21'
                     AND orders.from <= '2020-12-27 23:59:59'
                     AND goods.article IN (
                 '017811',
                 '017812',
                 '017813',
                 '008548',
                 '003223',
                 '017817',
                 '024528',
                 '025531',
                 '022783',
                 '020403',
                 '013919',
                 '013918'
               )
             ) AS good ON good.card_id = cards.id
WHERE cards.client_id = 625
GROUP BY good.article;


select * from goods_categories
where client_id = 625;


/*
Декорадо - 780
*/

SELECT * from goods_categories
where goods_categories.client_id = 4;

SELECT * from goods
where goods.client_id = 780;

select * from clients
where id = 4;


/*
Необходимо выгрузить в таблицу excel клиентов, которые зарегистрировались с 7.10 -29.12:

1) Регион (название группы магазинов)
2) Магазин
3)ФИО
4)Номер телефона
5) Дата регистрации.

Регион можно посмотреть в структуре личного кабинета ( Отчеты-->Продажи-->Структура). Пример выгрузки во вложении
*/

SELECT
  shops.name as shopName,
  profiles.name,
  profiles.phone,
  shops.id as shopID,
  hpc.created_at
FROM cards
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN shops ON orders.shop_id = shops.id
  LEFT OUTER JOIN (
                    SELECT *
                    FROM history_profiles_change
                    WHERE client_id = 888
                          AND is_creation = TRUE
                  ) AS hpc ON hpc.profile_id = profiles.id
WHERE cards.client_id = 888
  and hpc.created_at >= '2020-10-07'
  and hpc.created_at <= '2020-12-29 23:59:59'
GROUP BY cards.id;


select sale_general_report from reports_configurations
where client_id = 888;


select * from cards
  INNER JOIN profiles ON profiles.id = cards.profile_id

/*
Загрузить в список
*/

select profiles.id from cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
where cards.client_id = 625
AND cards.uid in ();


/*
Яндекс 0 баланс - 1926
*/
select * from buyer_lists
where buyer_lists.name = 'Яндекс 0 баланс';


select * from cards
where cards.uid = '221188221188';

select * from balance_movements
where card_id = 4778424;

select
  client_id,
  name,
  parent,
  description,
  uid,
  is_activated,
  parent_uid,
  accumulation_rate
from goods_categories
where client_id = 780;

SELECT *
FROM cards
WHERE cards.client_id = 888
      AND cards.uid = '79171332415';

/*
Привязкать телефон к личному кабинету
*

select * from goods
where goods.client_id = 1004;

*/

/*
Декорадо 780
 */

SELECT *
FROM goods
WHERE goods.client_id = 780;

SELECT *
FROM goods_categories
WHERE client_id = 780;

/*3735*/

SELECT *
FROM bills
WHERE id = 3735;

UPDATE bills
SET bills.exported = 1
WHERE bills.id = 3735;


/*
У АЗС есть списки клиентов "Monopoly", "Monopoly2", 1ДТ_РОЗНИЦА".

С 26.11 у данных клиентов наложились программы лояльности ( действовала и скидочная и бонусная система" .

Вопрос: Можно у этих  клиентов с 26.11-25.12 списать все начисленные бонусы за этот период?
*/

/*
1616
1669
1661
*/

SELECT *
FROM buyer_lists
WHERE client_id = 625
      AND name = '1ДТ_РОЗНИЦА';

SELECT buyers_list.buyers
FROM buyers_list
WHERE buyer_list_id = 1661;

SELECT cards.id
FROM cards
  INNER JOIN profiles ON cards.id = profiles.card_id
WHERE cards.client_id = 625
      AND profile_id IN (123);


UPDATE balance_movements
SET balance_movements.end_date = NOW()
where balance_movements.card_id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1;

UPDATE cards
SET cards.next_recalc = NOW()
where cards.id in ();

SELECT
  cards.uid,
  cards.next_recalc,
  balance_movements.is_positive,
  balance_movements.from_date,
  balance_movements.end_date
FROM cards
  INNER JOIN balance_movements on cards.id = balance_movements.card_id
WHERE cards.client_id = 625
      AND cards.id in ()
      AND balance_movements.from_date >= '2020.11.26'
      AND balance_movements.from_date <= '2020.12.25 23:59:59'
      AND balance_movements.is_positive = 1
GROUP BY balance_movements.id;

SELECT
  cards.id,
  cards.uid,
  cards.balance,
  goods_incomes.bonus_add
FROM cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  LEFT OUTER JOIN goods_incomes ON goods_incomes.order_id = orders.id
WHERE cards.client_id = 625
      AND cards.id in (123)
      AND orders.`from` >= '2020.11.26'
      AND orders.`from` <= '2020.12.25 23:59:59'
      AND goods_incomes.bonus_add > 0
GROUP BY orders.id;


/*
По приведенным ниже артикулам, необходимо выгрузить кол-во купленных чашек всего за период с 14.12-20.12

017811
017812
017813
017814
015912
016163
016172
016074
021662


Саша, по этим данным нужно выгрузить 51 неделю в понедельник.
*/


SELECT
  good.article,
  count(good.id)
FROM cards
  INNER JOIN (
               SELECT
                 orders.*,
                 goods.article
               FROM orders
                 INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 INNER JOIN goods ON goods.id = goods_incomes.goods_id
               WHERE orders.client_id = 625
                     AND orders.from >= '2021-01-04'
                     AND orders.from <= '2021-01-10 23:59:59'
                     AND goods.article IN (
                 '017811',
                 '017812',
                 '017813',
                 '017814',
                 '015912',
                 '016163',
                 '016172',
                 '016074',
                 '021662'
               )
             ) AS good ON good.card_id = cards.id
WHERE cards.client_id = 625
GROUP BY good.article;


select * from goods_categories
where client_id = 625;


/*
Декорадо - 780
*/

SELECT * from goods_categories
where goods_categories.client_id = 4;

SELECT * from goods
where goods.client_id = 780;

select * from clients
where id = 4;


/*
Необходимо выгрузить в таблицу excel клиентов, которые зарегистрировались с 7.10 -29.12:

1) Регион (название группы магазинов)
2) Магазин
3)ФИО
4)Номер телефона
5) Дата регистрации.

Регион можно посмотреть в структуре личного кабинета ( Отчеты-->Продажи-->Структура). Пример выгрузки во вложении
*/

SELECT
  shops.name as shopName,
  profiles.name,
  profiles.phone,
  shops.id as shopID,
  hpc.created_at
FROM cards
  LEFT OUTER JOIN orders ON orders.card_id = cards.id
  INNER JOIN profiles ON profiles.id = cards.profile_id
  INNER JOIN shops ON orders.shop_id = shops.id
  LEFT OUTER JOIN (
                    SELECT *
                    FROM history_profiles_change
                    WHERE client_id = 888
                          AND is_creation = TRUE
                  ) AS hpc ON hpc.profile_id = profiles.id
WHERE cards.client_id = 888
  and hpc.created_at >= '2020-10-07'
  and hpc.created_at <= '2020-12-29 23:59:59'
GROUP BY cards.id;


select sale_general_report from reports_configurations
where client_id = 888;


select * from cards
  INNER JOIN profiles ON profiles.id = cards.profile_id



/*
Загрузить в список
*/

select profiles.id from cards
  INNER JOIN profiles ON profiles.id = cards.profile_id
where cards.client_id = 625
AND cards.uid in ();


/*
Яндекс 0 баланс - 1926
*/
select * from buyer_lists
where buyer_lists.name = 'Яндекс 0 баланс';


select * from cards
where cards.uid = '221188221188';

select * from balance_movements
where card_id = 4778424;

select
  *
from goods_categories
where client_id = 780;

SELECT * from bills
where id = 3742;

update bills
set bills.exported = 1
where id = 3752;


/*
Необходимо по этим спискам клиентов: ГРУППА Кофейники 496979 и ГРУППА ХОТдог за 88 проверить покупали ли клиенты следующий товары за определенный период:( списки можно совместить)

52 неделя  - 28.12 - 03.01
53 неделя - 04.01-10.01


Файл с артикулами во вложении
*/

/*
ГРУППА Кофейники 496979 - 1920
ГРУППА ХОТдог за 88 - 1918
*/
SELECT * from buyer_lists
WHERE client_id = 625
and name = 'ГРУППА ХОТдог за 88';

SELECT buyers from buyers_list
where buyers_list.buyer_list_id = 1920;

select id from cards
where cards.profile_id in ()

SELECT
  good.article,
  count(good.id)
FROM cards
  INNER JOIN (
               SELECT
                 orders.*,
                 goods.article
               FROM orders
                 INNER JOIN goods_incomes ON orders.id = goods_incomes.order_id
                 INNER JOIN goods ON goods.id = goods_incomes.goods_id
               WHERE orders.client_id = 625
                     AND orders.from >= '2021-01-04'
                     AND orders.from <= '2021-01-10 23:59:59'
                     AND goods.article IN (
                 '017811',
                 '017812',
                 '017813',
                 '008548',
                 '003223',
                 '017817',
                 '024528',
                 '025531',
                 '022783',
                 '020403',
                 '013919',
                 '013918'
               )
             ) AS good ON good.card_id = cards.id
WHERE cards.client_id = 625
  AND cards.id in ()
GROUP BY good.article;



select *
from goods_categories
where client_id = 780;

SELECT * from goods_categories
where client_id = 780
      and name = 'ДВП';


SELECT * from goods_categories
where client_id = 780
      and uid = 'e5d4a65b-94eb-11e1-94b5-2c27d73a4ac6';

SELECT * from goods_categories
where client_id = 780
      and id = 771819;



